[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Replication Code",
    "section": "",
    "text": "Show code\n# Load Packages\nlibrary(tidyverse)\nlibrary(lmtest)\nlibrary(sandwich)\nlibrary(fixest)\nlibrary(did)\nlibrary(panelView)\nlibrary(car)\nlibrary(showtext)\nlibrary(usmap)\nlibrary(grid)\nlibrary(data.table)\nlibrary(FNN)\nlibrary(stringr)\nlibrary(plm)\nlibrary(scales)\nlibrary(sf)\nlibrary(modelsummary)\nlibrary(twfeivdecomp)\nlibrary(devtools)\ninstall_github(\"tye27/idid\")\nlibrary(idid)\n\n# Load Data\nsetwd(\"your/working/directory\")\ndf &lt;- read_csv(\"df.csv\")\n\n# Exclude 1999\nstate_year &lt;- df |&gt; \n  filter(year != 1999)"
  },
  {
    "objectID": "index.html#table-2-descriptive-statistics",
    "href": "index.html#table-2-descriptive-statistics",
    "title": "Replication Code",
    "section": "Table 2: Descriptive Statistics",
    "text": "Table 2: Descriptive Statistics\n\n\nShow code\n# select variables for descriptives\noptions(scipen = 999)\nvars &lt;- c(\n  \"num_esops_form_5500\",\n  \"union_density\",\n  \"num_strikes\",\n  \"left_wing\",\n  \"ln_state_pop\",\n  \"ln_manufact\",\n  \"manufact_per\",\n  \"ln_real_median_in\",\n  \"ln_num_firms\"\n)\n\n# calculate N, mean,SD, min, and max\ndescriptives &lt;- state_year |&gt; \n  summarise(across(all_of(vars),\n                   list(N = ~sum(!is.na(.)),\n                        Mean = ~mean(., na.rm=TRUE),\n                        SD = ~sd(., na.rm=TRUE),\n                        Min = ~min(., na.rm=TRUE),\n                        Max = ~max(., na.rm=TRUE)),\n                   .names = \"{.col}_{.fn}\")) |&gt; \n  as.list() |&gt; \n  stack() |&gt; \n  tidyr::separate(ind, into = c(\"Variable\",\"Statistic\"), sep = \"_(?=[^_]+$)\") |&gt;  \n  tidyr::pivot_wider(names_from = Statistic, values_from = values) # format table\n\ndescriptives[-1] &lt;- round(descriptives[-1], 3) # round to the third decimal\n\ndescriptives"
  },
  {
    "objectID": "index.html#figure-2-map-of-rtw-adoption",
    "href": "index.html#figure-2-map-of-rtw-adoption",
    "title": "Replication Code",
    "section": "Figure 2: Map of RTW Adoption",
    "text": "Figure 2: Map of RTW Adoption\n\n\nShow code\n# set all years for RTW adoption\nrtw_years &lt;- tribble(\n  ~abbr, ~year,\n  \"AL\", 1953, \"AR\", 1944, \"AZ\", 1946, \"FL\", 1944, \"GA\", 1947,\n  \"IA\", 1947, \"ID\", 1985, \"IN\", 2012, \"KS\", 1958, \"KY\", 2017,\n  \"LA\", 1976, \"MS\", 1954, \"NC\", 1947, \"ND\", 1947, \"NE\", 1946,\n  \"NV\", 1952, \"OK\", 2001, \"SC\", 1954, \"SD\", 1948, \"TN\", 1947,\n  \"TX\", 1947, \"UT\", 1955, \"VA\", 1947, \"WI\", 2015, \"WV\", 2016,\n  \"WY\", 1963, \"MI\", 2012\n) |&gt;\n  mutate(\n    decade = cut(\n      year,\n      breaks = c(1939, 1949, 1959, 1979, 1999, 2009, 2019),\n      labels = c(\"1940-49\", \"1950-59\", \"1960-79\", \"1980-99\", \"2000-09\", \"2010-19\"),\n      right = TRUE\n    )\n  ) # create groups\n\n# set U.S. map\nstates_poly &lt;- us_map(regions = \"states\") |&gt;\n  st_as_sf(coords = c(\"x\", \"y\"), crs = 4326, agr = \"constant\") |&gt;\n  group_by(abbr) |&gt;\n  summarise(geometry = st_union(st_geometry(.)), .groups = \"drop\") |&gt;\n  st_as_sf()\n\n# set colors for map\nblues &lt;- c(\n  \"1940-49\" = \"#E8F1FF\",\n  \"1950-59\" = \"#B3CDEB\",\n  \"1960-79\" = \"#96C3E3\",\n  \"1980-99\" = \"#64AAD4\",\n  \"2000-09\" = \"#2E7CB8\",\n  \"2010-19\" = \"#084A8C\"\n)\n\nsf_map &lt;- states_poly |&gt;\n  left_join(rtw_years, by = \"abbr\") # join data by state abbrev.\n\nlabels_sf &lt;- sf_map |&gt;\n  filter(!is.na(year)) |&gt;\n  mutate(\n    label_pt    = st_point_on_surface(st_geometry(.)),\n    label_color = if_else(decade == \"2010-19\", \"white\", \"black\")\n  ) # add year labels\n\n# plot map\np &lt;- ggplot(sf_map) +\n  geom_sf(aes(fill = decade), color = \"black\", linewidth = 0.25) +\n  geom_sf_text(\n    data = labels_sf,\n    aes(geometry = label_pt, label = year, color = label_color),\n    family = \"Times New Roman\",\n    size = 2.8\n  ) +\n  scale_fill_manual(\n    values = blues,\n    na.value = \"white\",\n    drop = FALSE,\n    name = NULL\n  ) +\n  scale_color_identity() +\n  coord_sf(datum = NA) +\n  theme_void(base_family = \"Times New Roman\") +\n  theme(\n    legend.position = c(0.05, 0.7)\n  )\n\np"
  },
  {
    "objectID": "index.html#table-a1-ols-regressions",
    "href": "index.html#table-a1-ols-regressions",
    "title": "Replication Code",
    "section": "Table A1: OLS Regressions",
    "text": "Table A1: OLS Regressions\n\n\nShow code\n# Create OLS Model Summary\n\n# rename coefficients\ncoef_map &lt;- c(\n  \"lag(union_density, 4)\"      = \"Union density\",\n  \"lag(union_density, 5)\"      = \"Union density\",\n  \"lag(union_density, 6)\"      = \"Union density\",\n\n  \"lag(I(union_density^2), 4)\" = \"Union density$^2$\",\n  \"lag(I(union_density^2), 5)\" = \"Union density$^2$\",\n  \"lag(I(union_density^2), 6)\" = \"Union density$^2$\",\n\n  \"lag(left_wing, 4)\"          = \"Left-wing government\",\n  \"lag(left_wing, 5)\"          = \"Left-wing government\",\n  \"lag(left_wing, 6)\"          = \"Left-wing government\",\n\n  \"lag(manufact_per, 4)\"       = \"Manufacturing employment share\",\n  \"lag(manufact_per, 5)\"       = \"Manufacturing employment share\",\n  \"lag(manufact_per, 6)\"       = \"Manufacturing employment share\",\n\n  \"lag(log(real_median_in), 4)\" = \"Log real median income\",\n  \"lag(log(real_median_in), 5)\" = \"Log real median income\",\n  \"lag(log(real_median_in), 6)\" = \"Log real median income\",\n\n  \"lag(log(state_pop), 4)\"     = \"Log population\",\n  \"lag(log(state_pop), 5)\"     = \"Log population\",\n  \"lag(log(state_pop), 6)\"     = \"Log population\",\n\n  \"lag(log(num_firms), 4)\"     = \"Log number of firms\",\n  \"lag(log(num_firms), 5)\"     = \"Log number of firms\",\n  \"lag(log(num_firms), 6)\"     = \"Log number of firms\",\n  \n  \"lag(num_esops_form_5500, 4)\" = \"LDV\",\n  \"lag(num_esops_form_5500, 5)\" = \"LDV\",\n  \"lag(num_esops_form_5500, 6)\" = \"LDV\"\n  \n)\n\n# set models to be included\nmodels &lt;- list(\n  \"Lag 4 Years\" = xm4,\n  \"Lag 5 Years\" = xm5,\n  \"Lag 6 Years\" = xm6\n)\n\n# add rows for FE\nfe_rows &lt;- data.frame(\n  term = c(\"State FE\", \"Year FE\"),\n  `Lag 4 Years` = c(\"✓\", \"✓\"),\n  `Lag 5 Years` = c(\"✓\", \"✓\"),\n  `Lag 6 Years` = c(\"✓\", \"✓\"),\n  stringsAsFactors = FALSE\n)\n\n# create table\nmodelsummary(\n  models,\n  coef_rename = coef_map,\n  stars = TRUE,\n  statistic = \"std.error\",\n  add_rows = fe_rows,\n gof_map = c(\"nobs\", \"r.squared\")\n)"
  },
  {
    "objectID": "index.html#table-3-balance-test",
    "href": "index.html#table-3-balance-test",
    "title": "Replication Code",
    "section": "Table 3: Balance Test",
    "text": "Table 3: Balance Test\n\n\nShow code\n# define treated and control\nbalance_data &lt;- did_data2 |&gt; \n  mutate(treated = as.integer(rtw_year &gt; 0)) \n\n# keep only pretreatment stuff\nbalance_data_pre &lt;- balance_data |&gt; \n  filter(\n    (treated == 1 & year &lt; rtw_year) |\n      (treated == 0)\n  )\n\n# select variables for the balance test\nbalance_vars &lt;- c(\n  \"ln_state_pop\",\n  \"manufact_per\",\n  \"ln_real_median_in\",\n  \"ln_num_firms\",\n  \"union_density\",\n  \"left_wing\"\n)\n\n# means, SDs, and Ns by treated vs control + differences\nbalance_means &lt;- balance_data_pre |&gt; \n  select(treated, all_of(balance_vars)) |&gt; \n  pivot_longer(\n    cols = -treated,\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) |&gt; \n  group_by(variable, treated) |&gt; \n  summarise(\n    mean = mean(value, na.rm = TRUE),\n    sd   = sd(value, na.rm = TRUE),\n    n    = sum(!is.na(value)),\n    .groups = \"drop\"\n  ) |&gt; \n  pivot_wider(\n    names_from = treated,\n    values_from = c(mean, sd, n),\n    names_glue = \"{.value}_{treated}\"\n  ) |&gt; \n  mutate(\n    diff = mean_1 - mean_0\n  )\n\n# run t test for each variable\ndiff_tests &lt;- lapply(balance_vars, function(v) {\n  ttest &lt;- t.test(balance_data_pre[[v]] ~ balance_data_pre$treated)\n  data.frame(\n    variable = v,\n    p_value  = ttest$p.value\n  )\n}) |&gt; \n  bind_rows()\n\n# make a table for the balance test\ntable3 &lt;- balance_means |&gt; \n  left_join(diff_tests, by = \"variable\") |&gt; \n  mutate(\n    stars = case_when(\n      p_value &lt; 0.01 ~ \"***\",\n      p_value &lt; 0.05 ~ \"**\",\n      p_value &lt; 0.10 ~ \"*\",\n      TRUE ~ \"\"\n    )\n  ) |&gt; \n  transmute(\n    Variable   = variable,\n    Treated    = round(mean_1, 3),\n    Control    = round(mean_0, 3), # round to third decimal point\n    Difference = paste0(round(diff, 3), stars),\n    N_Treated  = n_1,\n    N_Control  = n_0\n  )\n\ntable3"
  },
  {
    "objectID": "index.html#figure-3-parallel-trends",
    "href": "index.html#figure-3-parallel-trends",
    "title": "Replication Code",
    "section": "Figure 3: Parallel Trends",
    "text": "Figure 3: Parallel Trends\n\n\nShow code\n# define treated states\ntreated_states &lt;- c(\"MI\", \"WI\", \"IN\", \"KY\", \"WV\")\n\n# make separate treated dataset to identify average\ntreated_df &lt;- did_data2 |&gt; \n  filter(state %in% treated_states)\n\n# find the average of control states (non-adopters)\ncontrol_avg &lt;- did_data2 |&gt; \n  filter(!state %in% treated_states) |&gt; \n  group_by(year) |&gt; \n  summarize(\n    avg_esops = mean(num_esops_form_5500, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# make the plot\np2 &lt;- ggplot(treated_df, aes(x = year, y = num_esops_form_5500, group = state)) +\n  geom_line(\n    data = treated_df |&gt; \n      filter(year &lt;= rtw_year),\n    aes(color = \"Pre-RTW\"),\n    size = 1.5\n  ) +\n  geom_line(\n    data = treated_df |&gt; filter(year &gt;= rtw_year),\n    aes(color = \"Post-RTW\"),\n    size = 1.5\n  ) +\n  geom_line(\n    data = control_avg,\n    aes(x = year, y = avg_esops, color = \"Controls\", group = 1),\n    size = 2\n  ) +\n  geom_text(\n    data = ~ dplyr::filter(.x, year == max(year)), # label state abbrevs.\n    aes(label = state),\n    hjust = -0.1,\n    size = 7.5,              \n    color = \"black\"\n  ) +\n  scale_color_manual(\n    name = \"\",\n    values = c(\n      \"Pre-RTW\"  = \"gray50\",\n      \"Post-RTW\" = \"blue\",\n      \"Controls\" = \"red\"\n    )\n  ) +\n  labs(\n    x = \"\",\n    y = \"Number of ESOPs\"\n  ) +\n  theme_minimal(base_family = \"Times New Roman\") +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.grid.major.y = element_line(color = \"gray70\", linewidth = 0.4),\n    panel.grid.minor.y = element_line(color = \"gray80\", linewidth = 0.3),\n    axis.text  = element_text(size = 25),\n    axis.title = element_text(size = 25),\n    legend.text = element_text(size = 30),\n    panel.border = element_rect(color = \"black\", fill = NA, linewidth = 2),\n    legend.position = \"bottom\",\n    legend.box = \"horizontal\"\n  ) +\n  scale_y_continuous(\n  breaks = c(0, 50, 100, 150, 200, 250)\n)\n\np2\n# save as PNG\n#ggsave(\"p2_wide.png\", plot = p2, width = 12, height = 8, units = \"in\", dpi = 300) \n\n\n\n\nWald Estimator: Parallel Trends\n\n\nShow code\n# Run Model (With Wisconsin)\natt_all &lt;- att_gt(\n  yname  = \"num_esops_form_5500\",\n  tname  = \"year\",\n  idname = \"id\",\n  gname  = \"rtw_year\",\n  xformla = ~ manufact_per_l1 +\n              ln_real_median_in_l1 +\n              ln_num_firms_l1 +\n              ln_state_pop_l1,\n  data = did_data2\n)\n\n# run dynamic model\natt_event &lt;- aggte(att_all, type = \"dynamic\")\n\n# extract values of interest\negt &lt;- att_event$egt\natt &lt;- att_event$att.egt\n\n# indices for pre-treatment event times (leads)\npre_idx &lt;- which(egt &lt; 0 & !is.na(att))\ninffunc &lt;- att_event$inf.function$dynamic.inf.func.e\n\nVfull &lt;- crossprod(inffunc) / nrow(inffunc)\nb &lt;- att[pre_idx]\nV &lt;- Vfull[pre_idx, pre_idx, drop = FALSE]\n\n# Wald test\nW &lt;- as.numeric(t(b) %*% solve(V) %*% b)\ndf &lt;- length(b)\npval &lt;- 1 - pchisq(W, df)\n\nc(Wald = W, df = df, p_value = pval)\n\n\n\n\nShow code\n# Run Model (Without Wisconsin)\natt_no_wisc &lt;- att_gt(\n  yname  = \"num_esops_form_5500\",\n  tname  = \"year\",\n  idname = \"id\",\n  gname  = \"rtw_year\",\n  xformla = ~ manufact_per_l1 +\n              ln_real_median_in_l1 +\n              ln_num_firms_l1 +\n              ln_state_pop_l1,\n  data = did_data_no_wisconsin\n)\n\n# dynamic model\natt_event &lt;- aggte(att_no_wisc, type = \"dynamic\")\n\n# extract coefficients\negt &lt;- att_event$egt\natt &lt;- att_event$att.egt\n\n# indices for pre-treatment event times (leads)\npre_idx &lt;- which(egt &lt; 0 & !is.na(att))\ninffunc &lt;- att_event$inf.function$dynamic.inf.func.e\n\nVfull &lt;- crossprod(inffunc) / nrow(inffunc)\nb &lt;- att[pre_idx]\nV &lt;- Vfull[pre_idx, pre_idx, drop = FALSE]\n\n# Wald test\nW &lt;- as.numeric(t(b) %*% solve(V) %*% b)\ndf &lt;- length(b)\npval &lt;- 1 - pchisq(W, df)\n\nc(Wald = W, df = df, p_value = pval)"
  },
  {
    "objectID": "index.html#visualize-adoption",
    "href": "index.html#visualize-adoption",
    "title": "Replication Code",
    "section": "Visualize Adoption",
    "text": "Visualize Adoption\n\n\nShow code\n# limit to 2008 for visualization's sake\ndf &lt;- did_data2 |&gt;\n  filter(year &gt;= 2008) |&gt;\n  group_by(state) |&gt;\n  mutate(\n    treat_year = if (any(rtw == 1, na.rm = TRUE))\n      min(year[rtw == 1], na.rm = TRUE) else Inf\n  ) |&gt;\n  ungroup()\n\ndf_plot &lt;- df |&gt;\n  filter(is.finite(treat_year)) |&gt;\n  mutate(\n    state_ordered = reorder(state, treat_year),\n    status = ifelse(rtw == 1, \"Treated\", \"Not treated\")\n  ) \n\n# make a nice ggplot of adoption\nadoption &lt;- ggplot(df_plot, aes(x = year, y = state_ordered, fill = status)) +\n  geom_tile() +\n  scale_fill_manual(\n    values = c(\n      \"Not treated\" = \"#c6dbef\",  \n      \"Treated\"     = \"#2171b5\"   \n    )\n  ) +\n  scale_x_continuous(\n  breaks = c(2008, 2010, 2012, 2014, 2016, 2018, 2020)\n) +\n  labs(x = \"Year\", y = \"State\", fill = NULL) +\n theme_classic( base_size = 14) +\n  theme(\n    axis.text.y   = element_text(size = 15),\n    axis.text.x   = element_text(size = 17),\n    axis.title    = element_text(size = 17),\n    legend.text   = element_text(size = 15),\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\"\n  )\n\nadoption"
  },
  {
    "objectID": "index.html#run-models",
    "href": "index.html#run-models",
    "title": "Replication Code",
    "section": "Run Models",
    "text": "Run Models\n\n\nShow code\n# With Wisconsin\natt_all_union &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1,\n                        data = did_data2)\natt_overall2 &lt;- aggte(\n  att_all_union,\n  type = \"simple\"\n) # run simple ATT \n\n# Without Wisconsin\natt_no_wisc_union &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~  manufact_per_l1 +\n             real_median_in_l1 + ln_num_firms_l1, \n                        data = did_data_no_wisconsin)\n\natt_overall_no_wisc2 &lt;- aggte(\n  att_no_wisc_union,\n  type = \"simple\"\n) # run simple ATT"
  },
  {
    "objectID": "index.html#att-table-1",
    "href": "index.html#att-table-1",
    "title": "Replication Code",
    "section": "ATT Table 1",
    "text": "ATT Table 1\n\n\nShow code\n# Create function to extract coefficients\nextract_att &lt;- function(x) {\n  att &lt;- x$overall.att\n  se  &lt;- x$overall.se\n  ci_l &lt;- att - 1.96 * se # 95% CIs\n  ci_u &lt;- att + 1.96 * se\n\n  z &lt;- att / se\n  p &lt;- 2 * (1 - pnorm(abs(z)))\n  stars &lt;- ifelse(p &lt; 0.001, \"***\", # set significance levels\n           ifelse(p &lt; 0.01,  \"**\",\n           ifelse(p &lt; 0.05,  \"*\",\n           ifelse(p &lt; 0.10,  \"+\", \"\"))))\n\n  data.frame(\n    ATT = att,\n    SE = se,\n    CI_low = ci_l,\n    CI_high = ci_u,\n    p_value = p,\n    stars = stars\n  )\n}\n\n# extract coefficients\nr_all  &lt;- extract_att(att_overall2);         r_all$Sample  &lt;- \"All states\"\nr_nowi &lt;- extract_att(att_overall_no_wisc2); r_nowi$Sample &lt;- \"Excluding Wisconsin\"\n\natt_table &lt;- rbind(r_all, r_nowi)\n\n# Make it pretty\natt_table &lt;- att_table[, c(\"Sample\",\"ATT\",\"SE\",\"CI_low\",\"CI_high\",\"stars\",\"p_value\")]\natt_table$ATT  &lt;- round(att_table$ATT, 3)\natt_table$SE   &lt;- round(att_table$SE, 3)\natt_table$CI_low  &lt;- round(att_table$CI_low, 3)\natt_table$CI_high &lt;- round(att_table$CI_high, 3)\natt_table$p_value &lt;- signif(att_table$p_value, 3)\n\natt_table # table"
  },
  {
    "objectID": "index.html#compute-quantifiable-change",
    "href": "index.html#compute-quantifiable-change",
    "title": "Replication Code",
    "section": "Compute Quantifiable Change",
    "text": "Compute Quantifiable Change\n\n\nShow code\n# run dynamic ATT \ndyn &lt;- aggte(att_all_union, type = \"dynamic\")  \nsummary(dyn)\n\n# Create table to see the effect by year\natt_table_pp &lt;- data.frame(\n  event_time = dyn$egt,\n  att_pp     = dyn$att.egt,\n  se_pp      = dyn$se.egt\n) |&gt; \n  filter(event_time &gt;= 1 & event_time &lt;= 9) |&gt; \n  mutate(\n    ci95_lo_pp = att_pp - 1.96 * se_pp, # 95% CI\n    ci95_hi_pp = att_pp + 1.96 * se_pp\n  ) |&gt; \n  select(\n    event_time,\n    att_pp,\n    ci95_lo_pp,\n    ci95_hi_pp\n  )\n\natt_table_pp # table"
  },
  {
    "objectID": "index.html#figure-4-trends-in-union-density",
    "href": "index.html#figure-4-trends-in-union-density",
    "title": "Replication Code",
    "section": "Figure 4: Trends in Union Density",
    "text": "Figure 4: Trends in Union Density\n\n\nShow code\n# set timing year again \nrtw_timing &lt;- tribble(\n  ~state, ~rtw_year2,\n  \"AL\", 1953, \"AR\", 1944, \"AZ\", 1946, \"FL\", 1944, \"GA\", 1947,\n  \"IA\", 1947, \"ID\", 1985, \"IN\", 2012, \"KS\", 1958, \"KY\", 2017,\n  \"LA\", 1976, \"MS\", 1954, \"NC\", 1947, \"ND\", 1947, \"NE\", 1946,\n  \"NV\", 1952,              # OK removed\n  \"SC\", 1954, \"SD\", 1948, \"TN\", 1947,\n  \"TX\", 1947, \"UT\", 1955, \"VA\", 1947, \"WI\", 2015, \"WV\", 2016,\n  \"WY\", 1963, \"MI\", 2012\n)\n\n# define each group by \"never RTW\", \"always RTW\", or \"RTW switchers\"\nstate_year_classified &lt;- df |&gt;\n  full_join(rtw_timing, by = \"state\") |&gt;\n  mutate(\n    rtw_group = case_when(\n      is.na(rtw_year2)  ~ \"Never RTW\",\n      rtw_year2 &lt; 2000  ~ \"Always RTW\",\n      rtw_year2 &gt;= 2000 ~ \"RTW-Switchers\"\n    )\n  )\n\n# make dataset \nplot_df &lt;- state_year_classified |&gt;\n  mutate(\n    rtw_group = case_when(\n      always_treated == TRUE ~ \"Always RTW\",\n      switcher == TRUE       ~ \"RTW-Switchers\",\n      never_treated == TRUE  ~ \"Never RTW\",\n      TRUE                   ~ NA_character_\n    )\n  ) |&gt;\n  group_by(year, rtw_group) |&gt;\n  summarise(\n    union_density = mean(union_density, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nplot_df &lt;- plot_df |&gt; \n  filter(year !=1999) # remove 1999 again\n\n# make plot!\np_union &lt;- ggplot(\n  plot_df,\n  aes(x = year, y = union_density, color = rtw_group, linetype = rtw_group)\n) +\n  geom_line(linewidth = 1.2) +\n\n  scale_color_manual(\n    values = c(\n      \"Always RTW\"    = \"grey40\", \n      \"RTW-Switchers\" = \"blue\",\n      \"Never RTW\"     = \"red\"\n    )\n  ) +\n  scale_linetype_manual(\n    values = c(\n      \"Always RTW\"    = \"solid\",\n      \"RTW-Switchers\" = \"dashed\",\n      \"Never RTW\"     = \"solid\"\n    )\n  ) +\n\n  labs(\n    x = \"Year\",\n    y = \"Union Density\",\n    color = NULL,\n    linetype = NULL\n  ) +\n\n  theme_minimal() +\n  theme(\n     panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.grid.major.y = element_line(color = \"gray80\", linewidth = 0.5),\n    panel.grid.minor.y =element_line(color = \"gray90\", linewidth = 0.5),\n    plot.title = element_text(size = 18, hjust = 0.5),\n    axis.title = element_text(size = 18),\n    axis.text  = element_text(size = 17),\n    panel.border = element_rect(\n      color = \"black\",\n      fill  = NA,\n      linewidth = 0.6\n    ),\n    legend.position = \"bottom\",\n    legend.text = element_text(size = 14)\n  ) \n\np_union # plot of changes in union density by group"
  },
  {
    "objectID": "index.html#figure-5-rtw-on-union-density",
    "href": "index.html#figure-5-rtw-on-union-density",
    "title": "Replication Code",
    "section": "Figure 5: RTW on Union Density",
    "text": "Figure 5: RTW on Union Density\n\n\nShow code\n# run model (ATT dynamic) \natt_aggregate_no_wisc_union &lt;- aggte(\n  att_no_wisc_union,\n  type = \"dynamic\",\n  min_e = -10,\n  max_e = 10\n)\n\n# make a plot of the CIs and point estimates for the effect of RTW on union density\nggdid(att_aggregate_no_wisc_union) +\n  geom_hline(\n    yintercept = 0,\n    linetype = \"solid\",\n    linewidth = 0.6,\n    color = \"black\"\n  ) +\n  geom_vline(\n    xintercept = -0.5,\n    linetype = \"dashed\",\n    linewidth = 0.6,\n    color = \"black\"\n  ) +\n  coord_cartesian(ylim = c(-5, 5)) +\n  scale_color_manual(\n    values = c(\"grey50\", \"blue\"), # blue = post treatment\n    labels = c(\"Pre\", \"Post\")\n  ) +\n  scale_fill_manual(\n    values = c(\"gray80\", \"gray70\"),\n    labels = c(\"Pre\", \"Post\")\n  ) +\n  labs(\n    title = \"Effect of RTW on Union Density\",\n    color = NULL,\n    fill = NULL\n  ) +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_line(color = \"gray85\", linewidth = 0.4),\n    panel.border = element_rect(\n      color = \"black\",\n      fill = NA,\n      linewidth = 0.6\n    ),\n    axis.text = element_text(size = 14),\n    axis.title = element_text(size = 15),\n    legend.text = element_text(size = 15),\n    legend.title = element_blank()\n  )"
  },
  {
    "objectID": "index.html#run-models-1",
    "href": "index.html#run-models-1",
    "title": "Replication Code",
    "section": "Run Models",
    "text": "Run Models\n\n\nShow code\n# With WI\natt_all &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = did_data2)\n\n# run ATT model simple\natt_overall &lt;- aggte(\n  att_all,\n  type = \"simple\"\n)\n\n# Without WI\natt_no_wisc &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~  manufact_per_l1 +\n             real_median_in_l1 + ln_num_firms_l1,\n                        data = did_data_no_wisconsin)\n\n# run ATT model simple\natt_overall_no_wisc &lt;- aggte(\n  att_no_wisc,\n  type = \"simple\"\n)"
  },
  {
    "objectID": "index.html#att-table-2",
    "href": "index.html#att-table-2",
    "title": "Replication Code",
    "section": "ATT Table 2",
    "text": "ATT Table 2\n\n\nShow code\n# Models (Simple)\natt_overall &lt;- aggte(\n  att_all,\n  type = \"simple\"\n)\n\natt_overall_no_wisc &lt;- aggte(\n  att_no_wisc,\n  type = \"simple\"\n)\n\n# Extract coefficients\nr_all  &lt;- extract_att(att_overall);         r_all$Sample  &lt;- \"All states\"\nr_nowi &lt;- extract_att(att_overall_no_wisc); r_nowi$Sample &lt;- \"Excluding Wisconsin\"\n\natt_table &lt;- rbind(r_all, r_nowi)\n\n# Make it pretty\natt_table &lt;- att_table[, c(\"Sample\",\"ATT\",\"SE\",\"CI_low\",\"CI_high\",\"stars\",\"p_value\")]\natt_table$ATT  &lt;- round(att_table$ATT, 3)\natt_table$SE   &lt;- round(att_table$SE, 3)\natt_table$CI_low  &lt;- round(att_table$CI_low, 3)\natt_table$CI_high &lt;- round(att_table$CI_high, 3)\natt_table$p_value &lt;- signif(att_table$p_value, 3)\n\natt_table # table of overall ATT"
  },
  {
    "objectID": "index.html#compute-quantifiable-changes",
    "href": "index.html#compute-quantifiable-changes",
    "title": "Replication Code",
    "section": "Compute Quantifiable Changes",
    "text": "Compute Quantifiable Changes\n\n\nShow code\n# disaggregate the effect by year and statistical significance\ndyn2 &lt;- aggte(att_no_wisc, type = \"dynamic\")  # dynamic model\nsummary(dyn2)\n\natt_table_pp2 &lt;- data.frame(\n  event_time = dyn2$egt,\n  att_pp     = dyn2$att.egt,\n  se_pp      = dyn2$se.egt\n) |&gt; \n  filter(event_time &gt;= 1 & event_time &lt;= 9) |&gt; # 9 is the last year I have in the post-treatment period\n  mutate(\n    ci95_lo_pp = att_pp - 1.96 * se_pp, # set 95% CI\n    ci95_hi_pp = att_pp + 1.96 * se_pp\n  ) |&gt; \n  select(\n    event_time,\n    att_pp,\n    ci95_lo_pp,\n    ci95_hi_pp\n  )\n\natt_table_pp2"
  },
  {
    "objectID": "index.html#figure-6-rtw-on-esops",
    "href": "index.html#figure-6-rtw-on-esops",
    "title": "Replication Code",
    "section": "Figure 6: RTW on ESOPs",
    "text": "Figure 6: RTW on ESOPs\n\n\nShow code\n# visualize the effects computed above\natt_aggregate_no_wisc &lt;- aggte(\n  att_no_wisc,\n  type = \"dynamic\",\n  min_e = -10,\n  max_e = 10\n) # dynamic model\n\n# a nice graph of the effect of RTW on ESOP count\nggdid(att_aggregate_no_wisc) +\n  geom_hline(\n    yintercept = 0,\n    linetype = \"solid\",\n    linewidth = 0.6,\n    color = \"black\"\n  ) +\n  geom_vline(\n    xintercept = -0.5,\n    linetype = \"dashed\",\n    linewidth = 0.6,\n    color = \"black\"\n  ) +\n  coord_cartesian(ylim = c(-60, 60)) +\n  scale_color_manual(\n    values = c(\"grey50\", \"red\"), # red = post\n    labels = c(\"Pre\", \"Post\")\n  ) +\n  scale_fill_manual(\n    values = c(\"gray80\", \"gray70\"),\n    labels = c(\"Pre\", \"Post\")\n  ) +\n  labs(\n    title = \"Effect of RTW on ESOPs\",\n    color = NULL,\n    fill = NULL\n  ) +\n  theme_minimal() +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_line(color = \"gray85\", linewidth = 0.4),\n    panel.border = element_rect(\n      color = \"black\",\n      fill = NA,\n      linewidth = 0.6\n    ),\n    axis.text = element_text(size = 14),\n    axis.title = element_text(size = 15),\n    legend.text = element_text(size = 15),\n    legend.title = element_blank()\n  )"
  },
  {
    "objectID": "index.html#run-models-2",
    "href": "index.html#run-models-2",
    "title": "Replication Code",
    "section": "Run Models",
    "text": "Run Models\n\n\nShow code\n# Including Wisconsin\natt_all_control &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1 + union_density_l1, # CONTROLLING for union density\n                        data = did_data2)\n\n# Without Wisconsin\natt_no_wisc_control &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~  manufact_per_l1 +\n             real_median_in_l1 + ln_num_firms_l1 + union_density_l1,\n                        data = did_data_no_wisconsin)"
  },
  {
    "objectID": "index.html#att-table-3",
    "href": "index.html#att-table-3",
    "title": "Replication Code",
    "section": "ATT Table 3",
    "text": "ATT Table 3\n\n\nShow code\n# run simple ATT models\natt_overall2 &lt;- aggte(\n  att_all_control,\n  type = \"simple\"\n)\natt_overall_no_wisc2 &lt;- aggte(\n  att_no_wisc_control,\n  type = \"simple\"\n)\n\n# extract coefficients\nr_all  &lt;- extract_att(att_overall2);         r_all$Sample  &lt;- \"All states\"\nr_nowi &lt;- extract_att(att_overall_no_wisc2); r_nowi$Sample &lt;- \"Excluding Wisconsin\"\n\natt_table &lt;- rbind(r_all, r_nowi)\n\n# make it pretty\natt_table &lt;- att_table[, c(\"Sample\",\"ATT\",\"SE\",\"CI_low\",\"CI_high\",\"stars\",\"p_value\")]\natt_table$ATT  &lt;- round(att_table$ATT, 3)\natt_table$SE   &lt;- round(att_table$SE, 3)\natt_table$CI_low  &lt;- round(att_table$CI_low, 3)\natt_table$CI_high &lt;- round(att_table$CI_high, 3)\natt_table$p_value &lt;- signif(att_table$p_value, 3)\n\natt_table # table"
  },
  {
    "objectID": "index.html#state-by-state-estimates",
    "href": "index.html#state-by-state-estimates",
    "title": "Replication Code",
    "section": "State-By-State Estimates",
    "text": "State-By-State Estimates\n\n\nShow code\n# INDIANA\nindiana &lt;- did_data2 |&gt; \n  filter(state != \"WI\") |&gt; \n  filter(state != \"KY\") |&gt; \n  filter(state != \"WV\") |&gt; \n  filter(state != \"MI\")\n\n# esops\natt_ind &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = indiana)\n\n# ATT simple\natt_indiana &lt;- aggte(\n  att_ind,\n  type = \"simple\"\n)\n\n# union density\natt_ind2 &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = indiana)\n\n# ATT simple\natt_indiana2 &lt;- aggte(\n  att_ind2,\n  type = \"simple\"\n)\n\n\n\n\nShow code\n# MICHIGAN\nmichigan &lt;- did_data2 |&gt; \n  filter(state != \"WI\") |&gt; \n  filter(state != \"KY\") |&gt; \n  filter(state != \"WV\") |&gt; \n  filter(state != \"IN\")\n\n# esops\natt_mich &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1,\n                        data = michigan)\n# ATT simple\natt_michigan &lt;- aggte(\n  att_mich,\n  type = \"simple\"\n)\n\n# union density\natt_mich2 &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = michigan)\n# ATT simple\natt_michigan2 &lt;- aggte(\n  att_mich2,\n  type = \"simple\"\n)\n\n\n\n\nShow code\n# WEST VIRGINIA\nwest_virg &lt;- did_data2 |&gt; \n  filter(state != \"WI\") |&gt; \n  filter(state != \"KY\") |&gt; \n  filter(state != \"MI\") |&gt; \n  filter(state != \"IN\")\n\n# esops\natt_wv &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = west_virg)\n# ATT simple\natt_west_v &lt;- aggte(\n  att_wv,\n  type = \"simple\"\n)\n\n# union denstiy\natt_wv2 &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = west_virg)\n# ATT simple\natt_west_v2 &lt;- aggte(\n  att_wv2,\n  type = \"simple\"\n)\n\n\n\n\nShow code\n# KENTUCKY\nkentucky &lt;- did_data2 |&gt; \n  filter(state != \"WI\") |&gt; \n  filter(state != \"WV\") |&gt; \n  filter(state != \"MI\") |&gt; \n  filter(state != \"IN\")\n\natt_kentuc &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = kentucky)\n# ATT simple\natt_kentucky &lt;- aggte(\n  att_kentuc,\n  type = \"simple\"\n)\n\n# union density\natt_kentuc2 &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = kentucky)\n# ATT simple\natt_kentucky2 &lt;- aggte(\n  att_kentuc2,\n  type = \"simple\"\n)\n\n\n\n\nShow code\n# WISCONSIN\nwisc &lt;- did_data2 |&gt; \n  filter(state != \"KY\") |&gt; \n  filter(state != \"WV\") |&gt; \n  filter(state != \"MI\") |&gt; \n  filter(state != \"IN\")\n\n# esops\natt_wisc &lt;- att_gt(yname = \"num_esops_form_5500\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1, \n                        data = wisc)\n# ATT simple\natt_wisconsin &lt;- aggte(\n  att_wisc,\n  type = \"simple\"\n)\n\n# union density=\natt_wisc2 &lt;- att_gt(yname = \"union_density\",\n                        tname = \"year\",\n                        idname = \"id\",\n                        gname = \"rtw_year\",\n                        xformla = ~ manufact_per_l1 +\n             ln_real_median_in_l1 + ln_num_firms_l1,\n                        data = wisc)\n# ATT simple\natt_wisconsin2 &lt;- aggte(\n  att_wisc2,\n  type = \"simple\"\n)"
  },
  {
    "objectID": "index.html#att-table-disaggregated-by-state",
    "href": "index.html#att-table-disaggregated-by-state",
    "title": "Replication Code",
    "section": "ATT Table: Disaggregated by State",
    "text": "ATT Table: Disaggregated by State\n\n\nShow code\n# extract coefficients by state\nr_bench &lt;- extract\nr_ind  &lt;- extract_att(att_indiana);         r_ind$Sample  &lt;- \"Indiana\"\nr_mich &lt;- extract_att(att_michigan); r_mich$Sample &lt;- \"Michigan\"\nr_wv  &lt;- extract_att(att_west_v);     r_wv$Sample  &lt;- \"West Virginia\"\nr_ky &lt;- extract_att(att_kentucky);     r_ky$Sample  &lt;- \"Kentucky\"\nr_wisc &lt;- extract_att(att_wisconsin);     r_wisc$Sample  &lt;- \"Wisconsin\"\n\natt_table_states &lt;- rbind(r_ind, r_mich, r_wv, r_ky, r_wisc)\n\n# Make it pretty\natt_table_states &lt;- att_table_states[, c(\"Sample\",\"ATT\",\"SE\",\"CI_low\",\"CI_high\",\"stars\",\"p_value\")]\natt_table_states$ATT  &lt;- round(att_table_states$ATT, 3)\natt_table_states$SE   &lt;- round(att_table_states$SE, 3)\natt_table_states$CI_low  &lt;- round(att_table_states$CI_low, 3)\natt_table_states$CI_high &lt;- round(att_table_states$CI_high, 3)\natt_table_states$p_value &lt;- signif(att_table_states$p_value, 3)\n\natt_table_states # final table"
  }
]